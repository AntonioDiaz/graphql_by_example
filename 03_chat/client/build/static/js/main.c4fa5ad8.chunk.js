(this["webpackJsonpchat-client"]=this["webpackJsonpchat-client"]||[]).push([[0],{28:function(e,t,a){e.exports=a(42)},30:function(e,t,a){},42:function(e,t,a){"use strict";a.r(t);a(29),a(30);var n=a(3),r=a.n(n),s=a(21),c=a.n(s),o=a(7),i=a(8),u=a(10),l=a(9),m=a(5),h=a.n(m),p=a(11),d=a(22),f=a.n(d),v="http://localhost:9000/login";function b(e){return f()(e).sub}function y(){return localStorage.getItem("accessToken")}function g(){var e=y();return e?b(e):null}function E(e,t){return O.apply(this,arguments)}function O(){return(O=Object(p.a)(h.a.mark((function e(t,a){var n,r,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(v,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:t,password:a})});case 2:if((n=e.sent).ok){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,n.json();case 7:return r=e.sent,s=r.token,localStorage.setItem("accessToken",s),e.abrupt("return",b(s));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var j=a(17),k=a(18),w=a.n(k),N=a(12),x=a(46),S=a(44),C=a(45),L=N.a.from([new N.a((function(e,t){var a=y();return a&&e.setContext({headers:{authorization:"Bearer ".concat(a)}}),t(e)})),new x.a({uri:"http://localhost:9000/graphql"})]),M=new S.a({cache:new C.a,link:L,defaultOptions:{query:{fetchPolicy:"no-cache"}}});function I(){var e=Object(j.a)(["\n  mutation AddMessageMutation($input: MessageInput!) {\n    message: addMessage(input: $input) {\n      id\n      from\n      text\n    }\n  }\n"]);return I=function(){return e},e}function P(){var e=Object(j.a)(["\n  query MessagesQuery {\n    messages {\n      id\n      from\n      text\n    }\n  }\n"]);return P=function(){return e},e}var q=w()(P()),A=w()(I());function T(e){return R.apply(this,arguments)}function R(){return(R=Object(p.a)(h.a.mark((function e(t){var a,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.mutate({mutation:A,variables:{input:{text:t}}});case 2:return a=e.sent,n=a.data,e.abrupt("return",n.message);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return J.apply(this,arguments)}function J(){return(J=Object(p.a)(h.a.mark((function e(){var t,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.query({query:q});case 2:return t=e.sent,a=t.data,e.abrupt("return",a.messages);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"handleKeyPress",value:function(e){"Enter"===e.key&&(this.props.onSend(e.target.value),e.target.value="")}},{key:"render",value:function(){return r.a.createElement("div",{className:"box"},r.a.createElement("p",{className:"control"},r.a.createElement("input",{className:"input",type:"text",placeholder:"Say something...",onKeyPress:this.handleKeyPress.bind(this)})))}}]),a}(n.Component),B=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).boxRef=r.a.createRef(),e}return Object(i.a)(a,[{key:"componentDidUpdate",value:function(){var e=this.boxRef.current;e.scrollTo(0,e.scrollHeight)}},{key:"render",value:function(){var e=this.props.messages;return r.a.createElement("div",{ref:this.boxRef,className:"box",style:{height:"50vh",overflowY:"scroll"}},r.a.createElement("table",null,r.a.createElement("tbody",null,e.map(this.renderMessage.bind(this)))))}},{key:"renderMessage",value:function(e){var t=this.props.user,a="tag";return e.from===t&&(a+=" is-primary"),r.a.createElement("tr",{key:e.id},r.a.createElement("td",null,r.a.createElement("span",{className:a},e.from)),r.a.createElement("td",{style:{paddingLeft:"0.75em"}},e.text))}}]),a}(n.Component),$=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={messages:[]},e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=Object(p.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:t=e.sent,this.setState({messages:t});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleSend",value:function(){var e=Object(p.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T(t);case 2:a=e.sent,this.setState({messages:this.state.messages.concat(a)});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props.user,t=this.state.messages;return r.a.createElement("section",{className:"section"},r.a.createElement("div",{className:"container"},r.a.createElement("h1",{className:"title"},"Chatting as ",e),r.a.createElement(B,{user:e,messages:t}),r.a.createElement(K,{onSend:this.handleSend.bind(this)})))}}]),a}(n.Component),z=a(27),H=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={name:"",password:"",error:!1},e}return Object(i.a)(a,[{key:"handleChange",value:function(e){var t=e.target,a=t.name,n=t.value;this.setState(Object(z.a)({},a,n))}},{key:"handleSubmit",value:function(){var e=Object(p.a)(h.a.mark((function e(t){var a,n,r,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=this.state,n=a.name,r=a.password,e.next=4,E(n,r);case 4:(s=e.sent)?this.props.onLogin(s):this.setState({error:!0});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.name,a=e.password,n=e.error;return r.a.createElement("div",null,r.a.createElement("section",{className:"section"},r.a.createElement("div",{className:"container"},r.a.createElement("h1",{className:"title"},"Chat Login"),r.a.createElement("form",null,r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Name"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input",type:"text",name:"name",value:t,onChange:this.handleChange.bind(this)}))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Password"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input",type:"password",name:"password",value:a,onChange:this.handleChange.bind(this)}))),r.a.createElement("div",{className:"field"},n&&r.a.createElement("p",{className:"help is-danger"},"Invalid Credentials"),r.a.createElement("div",{className:"control"},r.a.createElement("button",{className:"button is-link",onClick:this.handleSubmit.bind(this)},"Login")))))))}}]),a}(n.Component),Q=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props.onLogout;return r.a.createElement("nav",{className:"nabar"},r.a.createElement("div",{className:"navbar-end"},r.a.createElement("button",{className:"button navbar-item",onClick:e},"Logout")))}}]),a}(n.Component),U=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={user:g()},e}return Object(i.a)(a,[{key:"handleLogin",value:function(e){this.setState({user:e})}},{key:"handleLogout",value:function(){localStorage.removeItem("accessToken"),this.setState({user:null})}},{key:"render",value:function(){var e=this.state.user;return e?r.a.createElement("div",null,r.a.createElement(Q,{onLogout:this.handleLogout.bind(this)}),r.a.createElement($,{user:e})):r.a.createElement(H,{onLogin:this.handleLogin.bind(this)})}}]),a}(n.Component);c.a.render(r.a.createElement(U,null),document.getElementById("root"))}},[[28,1,2]]]);
//# sourceMappingURL=main.c4fa5ad8.chunk.js.map